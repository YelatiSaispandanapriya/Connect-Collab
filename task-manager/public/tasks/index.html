<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage Tasks</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter',sans-serif; background:#f0f4f8; margin:0; padding:20px;}
h1 { text-align:center; color:#1E3C72; margin-bottom:20px;}
.container { max-width:600px; margin:auto; background:#fff; border-radius:12px; padding:25px; box-shadow:0 15px 35px rgba(0,0,0,0.1);}
.task-list { list-style:none; padding:0; margin:0 0 20px 0;}
.task-item { display:flex; align-items:center; justify-content:space-between; padding:12px 15px; border-bottom:1px solid #eee; border-radius:8px; margin-bottom:8px; background:#f9f9f9; transition:0.3s;}
.task-item.completed .title { text-decoration:line-through; color:#888;}
.task-item .title { flex:1; margin-left:10px; font-size:15px;}
.task-item button { background:#e53935; color:#fff; border:none; padding:6px 12px; border-radius:6px; cursor:pointer;}
.task-item button:hover { opacity:0.85;}
.form-buttons { display:flex; gap:10px; margin-top:15px; justify-content:flex-end; flex-wrap:wrap;}
.form-buttons button { padding:12px 20px; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition:0.3s;}
.form-buttons button.add { background:linear-gradient(135deg,#1E88E5,#1976d2); color:#fff;}
.form-buttons button.download { background:linear-gradient(135deg,#43a047,#388e3c); color:#fff;}
.form-buttons button.logout { background:linear-gradient(135deg,#f4511e,#e53935); color:#fff;}
.form-buttons button:hover { opacity:0.9; transform:translateY(-2px);}
#taskTitle { width:100%; padding:12px; border-radius:8px; border:1px solid #ccc; font-size:15px; margin-bottom:10px;}
#toast { display:none; }
@media(max-width:500px){.form-buttons{flex-direction:column}.form-buttons button{width:100%;}}
</style>
</head>
<body>
<div class="container">
<h1>Manage Your Tasks</h1>

<ul class="task-list" id="taskList"></ul>

<form id="taskForm">
  <input type="text" id="taskTitle" name="title" placeholder="Enter new task" required>
  <div class="form-buttons">
    <button type="submit" class="add">Add Task</button>
    <button type="button" class="download" onclick="downloadTasks()">Download Excel</button>
    <button type="button" class="logout" onclick="logout()">Logout</button>
  </div>
</form>
</div>

<div id="toast"></div>

<script>
const taskList=document.getElementById('taskList');
const taskForm=document.getElementById('taskForm');

// Toast
function showToast(msg,type='success'){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.style.display='block';
  t.style.position='fixed';
  t.style.top='20px';
  t.style.right='20px';
  t.style.padding='15px 25px';
  t.style.borderRadius='8px';
  t.style.color='#fff';
  t.style.background = type==='success'?'#43a047':'#e53935';
  t.style.boxShadow='0 5px 15px rgba(0,0,0,0.2)';
  t.style.fontWeight='600';
  t.style.zIndex='1000';
  setTimeout(()=>{t.style.display='none';},3000);
}

// Load tasks
async function loadTasks(){
  const res=await fetch('/get-tasks');
  const tasks=await res.json();
  taskList.innerHTML='';
  tasks.forEach(task=>{
    const li=document.createElement('li');
    li.className='task-item'+(task.completed?' completed':'');
    const checkbox=document.createElement('input');
    checkbox.type='checkbox';
    checkbox.checked=task.completed;
    checkbox.addEventListener('change',()=>toggleTask(task._id));
    const title=document.createElement('span');
    title.className='title';
    title.textContent=task.title;
    const deleteBtn=document.createElement('button');
    deleteBtn.textContent='Delete';
    deleteBtn.addEventListener('click',()=>deleteTask(task._id));
    li.appendChild(checkbox);
    li.appendChild(title);
    li.appendChild(deleteBtn);
    taskList.appendChild(li);
  });
}

// Add task
taskForm.addEventListener('submit', async e=>{
  e.preventDefault();
  const formData=new FormData(taskForm);
  const res=await fetch('/add-task',{method:'POST',body:new URLSearchParams(formData)});
  if(res.ok){ showToast('Task added successfully','success'); taskForm.reset(); loadTasks();}
  else showToast('Failed to add task','error');
});

// Toggle task
async function toggleTask(id){
  const res=await fetch(`/toggle-task/${id}`);
  if(res.ok){ showToast('Task updated','success'); loadTasks();}
  else showToast('Failed to update task','error');
}

// Delete task
async function deleteTask(id){
  const res=await fetch(`/delete-task/${id}`);
  if(res.ok){ showToast('Task deleted','success'); loadTasks();}
  else showToast('Failed to delete task','error');
}

// Download Excel
function downloadTasks(){ window.location.href='/tasks/download'; }

// Logout
function logout(){ window.location.href='/logout'; }

// Show toast from URL (login/register)
const params=new URLSearchParams(window.location.search);
const msg=params.get('msg');
const type=params.get('type')||'success';
if(msg){ showToast(msg.replace(/\+/g,' '),type); window.history.replaceState({},document.title,window.location.pathname); }

// Initial load
loadTasks();
</script>
</body>
</html>
